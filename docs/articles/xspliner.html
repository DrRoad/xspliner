<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>xspliner package - basic theory and usage • xspliner</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src="https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/xspliner.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>xspliner package - basic theory and usage</h1>
                        <h4 class="author">Krystian Igras</h4>
            
            <h4 class="date">2018-12-03</h4>
      
      
      <div class="hidden name"><code>xspliner.Rmd</code></div>

    </div>

    
    
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>In regression or classification problem, the main issue is choosing the model that should meet our requirements as much as possible. On the one hand, we want the chosen solution to have the best statistical properties such as accuracy, SSE or R Squared - on the other hand, we focus on the interpretability of the model.</p>
<p>In the first case, black box models, such as randomForest or XGBoost, perform better than others, while the second case is dominated by linear models. The xspliner package aims to combine both methods: use the knowledge gathered from black box models in order to build an interpretable linear one.</p>
</div>
<div id="general-idea" class="section level2">
<h2 class="hasAnchor">
<a href="#general-idea" class="anchor"></a>General idea</h2>
<p>Below graphics show general idea used in xspliner model <em>(todo)</em></p>
<div id="black-box-variable-response" class="section level3">
<h3 class="hasAnchor">
<a href="#black-box-variable-response" class="anchor"></a>Black box variable response</h3>
<p>When black box model is already built, you may want to check how each predictor variable affects the final response. This is quite easy when you use a linear model or have low dimensional data (up to 2, 3 dimensions). One of ideas for testing the predictor impact in more complicated model is to check an average model response of the selected variable.</p>
<p>One of such approaches called Partial Dependence Plots is implemented in the <a href="https://github.com/bgreenwell/pdp">pdp</a> package (Brandon M. Greenwell (2017). Pdp: The R Journal, 9 (1), 421-436.), or the <a href="https://CRAN.R-project.org/package=ALEPlot">ALEPlot</a> package (Dan Apley (2017). ALEPlot: Accumulated Local Effects Plots and Partial Dependence Plots.) using Accumulated Local Effects Plots.</p>
<p>In each case, we get a single variable function, which should explain the impact of the predictor on the response variable.</p>
<p>The following pictures show the <code>ptration</code> impact on <code>cmedv</code> in some randomForest model based on Boston Housing Data. Below curves are obtained by the approach of the pdp and ale methods.</p>
<p><img src="xspliner_files/figure-html/unnamed-chunk-2-1.png" width="192"><img src="xspliner_files/figure-html/unnamed-chunk-2-2.png" width="192"></p>
<p>As we can see, above functions are irregular, making it difficult to interpret explained effect.</p>
<p>If above functions had linear character, one would be tempted to approximate them with linear function. As a result one could easily interpret how it affects the variable explained in the black box model. What if the function is irregular, as above?</p>
</div>
<div id="splines" class="section level3">
<h3 class="hasAnchor">
<a href="#splines" class="anchor"></a>Splines</h3>
<p>Due to the large errors that occurs with approximation of functions with polynomials, the approach using spline approximation is most common solution. Splines (functions that piecewise polynomials) have good approximating properties, in addition their form is overt so we can thus interpret the resulting function.</p>
<p>The following graphics show spline approximations of pdp and ale curves:</p>
<p><img src="xspliner_files/figure-html/unnamed-chunk-3-1.png" width="192"><img src="xspliner_files/figure-html/unnamed-chunk-3-2.png" width="192"></p>
</div>
<div id="linear-models-based-on-response-function-and-splines" class="section level3">
<h3 class="hasAnchor">
<a href="#linear-models-based-on-response-function-and-splines" class="anchor"></a>Linear models based on response function and splines</h3>
<p>The general idea of how to use the response function and splines to build an interpretable model is as follows.</p>
<ul>
<li>For each variable used in the black box model, create a response function based on one of the known methods, let’s mark it <span class="math inline">\(f_{x}\)</span>
</li>
<li>Approximate <span class="math inline">\(f_{x}\)</span> using spline - the result is <span class="math inline">\(\widetilde{f}_{x}\)</span>
</li>
<li>Build linear model, in which each predictior <span class="math inline">\(x_{i}\)</span> is transformed with approximated response function: <span class="math inline">\(\widetilde{f}_{x_{i}}(x_{i})\)</span>
</li>
</ul>
<p>Shortly, using black box formula <span class="math display">\[y \sim x_{1} + \cdots + x_{n}\]</span> we use <span class="math display">\[y \sim \widetilde{f}_{x_{1}}(x_{1}) + \cdots + \widetilde{f}_{x_{n}}(x_{n})\]</span> in linear one.</p>
<p>The resulting model uses part of the information that was extracted while building black box model.</p>
</div>
</div>
<div id="how-to-do-it-with-xspliner" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-do-it-with-xspliner" class="anchor"></a>How to do it with xspliner?</h2>
<div id="defining-formula" class="section level3">
<h3 class="hasAnchor">
<a href="#defining-formula" class="anchor"></a>Defining formula</h3>
<p>This sections shows, how to build formula interpretable by xspliner package using Boston Housing Data from <code>pdp</code> package.</p>
<p>Read the data</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(boston)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(boston)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; 'data.frame':    506 obs. of  16 variables:</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt;  $ lon    : num  -71 -71 -70.9 -70.9 -70.9 ...</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt;  $ lat    : num  42.3 42.3 42.3 42.3 42.3 ...</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;  $ cmedv  : num  24 21.6 34.7 33.4 36.2 28.7 22.9 22.1 16.5 18.9 ...</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt;  $ crim   : num  0.00632 0.02731 0.02729 0.03237 0.06905 ...</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt;  $ zn     : num  18 0 0 0 0 0 12.5 12.5 12.5 12.5 ...</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt;  $ indus  : num  2.31 7.07 7.07 2.18 2.18 2.18 7.87 7.87 7.87 7.87 ...</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;  $ chas   : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt;  $ nox    : num  0.538 0.469 0.469 0.458 0.458 0.458 0.524 0.524 0.524 0.524 ...</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt;  $ rm     : num  6.58 6.42 7.18 7 7.15 ...</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt;  $ age    : num  65.2 78.9 61.1 45.8 54.2 58.7 66.6 96.1 100 85.9 ...</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt;  $ dis    : num  4.09 4.97 4.97 6.06 6.06 ...</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt;  $ rad    : int  1 2 2 3 3 3 5 5 5 5 ...</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt;  $ tax    : int  296 242 242 222 222 222 311 311 311 311 ...</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt;  $ ptratio: num  15.3 17.8 17.8 18.7 18.7 18.7 15.2 15.2 15.2 15.2 ...</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt;  $ b      : num  397 397 393 395 397 ...</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt;  $ lstat  : num  4.98 9.14 4.03 2.94 5.33 ...</span></a></code></pre></div>
<p>We’re going to prepare formula</p>
<pre><code>cmedv ~ rm + lstat + nox</code></pre>
<p>Specify which variables should be transformed. In this example we will transform <code>nox</code> variable.</p>
<p>To indicate transformation use <code>xs(nos)</code> symbol.</p>
<p>So we have:</p>
<pre><code>cmedv ~ rm + lstat + xs(nox)</code></pre>
<p>As the algoritm goes threw creating response function and its approximation we need to specify desirable parameters.</p>
<div id="specifying-which-method-should-we-use-to-build-response-function" class="section level4">
<h4 class="hasAnchor">
<a href="#specifying-which-method-should-we-use-to-build-response-function" class="anchor"></a>Specifying which method should we use to build response function</h4>
<pre><code>effect = list(
  type = &lt;method_type&gt; # "pdp" or "ale",
  ... # named list - other parameters passed for chosen method
)</code></pre>
<p>Possible parameters that can be passed into <code>...</code> find in</p>
<ul>
<li>
<code><a href="https://www.rdocumentation.org/packages/pdp/topics/partial">pdp::partial</a></code> in case of <code>type = "pdp"</code>
</li>
<li>
<code><a href="https://www.rdocumentation.org/packages/ALEPlot/topics/ALEPlot">ALEPlot::ALEPlot</a></code> in case of <code>type = "ale"</code>
</li>
</ul>
</div>
<div id="specifying-spline-approximation-parameters" class="section level4">
<h4 class="hasAnchor">
<a href="#specifying-spline-approximation-parameters" class="anchor"></a>Specifying spline approximation parameters</h4>
<p>Response function is approximated with <code><a href="https://www.rdocumentation.org/packages/mgcv/topics/gam">mgcv::gam</a></code> package and <code><a href="https://www.rdocumentation.org/packages/mgcv/topics/s">mgcv::s</a></code> smoothing function.</p>
<p><code>xspliner</code> allows using all smoothing methods provided by <code><a href="https://www.rdocumentation.org/packages/mgcv/topics/s">mgcv::s</a></code>. You can pass corresponding parameters in</p>
<pre><code>transition = &lt;mgcv::s parameters&gt; # named list</code></pre>
<p><strong>Remark</strong> One of special parameters passed for <code>transition</code> is <code>increasing</code>. When the parameter occurs then:</p>
<ul>
<li>for <code>TRUE</code> value, approximation will be increasing</li>
<li>for <code>FALSE</code> value, approximation will be decreasing <br>
</li>
</ul>
<p>Let’s assume we want to build response function basing on “pdp” package. Response function is presented as data.frame with two columns (in our case):</p>
<ul>
<li>
<code>nox</code> - <span class="math inline">\(n\)</span> evenly spaced points across range of <code>nox</code> variable. Specified by <code>grid.resolution</code> parameter (51 by default)</li>
<li>
<code>yhat</code> - response function values on points specified in the first column</li>
</ul>
<p>As we want to store 100 values for response function data, we specify in formula:</p>
<pre><code>cmedv ~ rm + lstat + xs(nox, effect = list(type = "pdp", grid.resolution = 100))</code></pre>
<p>We also want to approximate response function with cubic splines and basis dimension equal to 10. As we can see in <code><a href="https://www.rdocumentation.org/packages/mgcv/topics/s">mgcv::s</a></code> documentation, we need to set: <code>k = 10</code> and <code>bs = "cr"</code>.</p>
<p>So we get the final formula:</p>
<pre><code>cmedv ~ rm + lstat + xs(nox, 
  effect = list(type = "pdp", grid.resolution = 100),
  transition = list(k = 10, bs = "cr"))</code></pre>
</div>
</div>
<div id="building-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#building-the-model" class="anchor"></a>Building the model</h3>
<p>Having the formula defined, we almost have all the required data provided. The only one left, that the approach requires is the black box model that is the basis of our resulting model.</p>
<p>Let’s define <code>randomForest</code> for this purpose.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">boston_rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cmedv <span class="op">~</span><span class="st"> </span>rm <span class="op">+</span><span class="st"> </span>lstat <span class="op">+</span><span class="st"> </span>nox, <span class="dt">data =</span> boston) </a></code></pre></div>
<p>As we already have the black box provided, we can use <code>xspline</code> function to build the desired model.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">xp_model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/xspline.html">xspline</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  cmedv <span class="op">~</span><span class="st"> </span>rm <span class="op">+</span><span class="st"> </span>lstat <span class="op">+</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">    </span><span class="kw">xs</span>(nox, </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">       <span class="dt">effect =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">type =</span> <span class="st">"pdp"</span>, <span class="dt">grid.resolution =</span> <span class="dv">100</span>), </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">       <span class="dt">transition =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">k =</span> <span class="dv">10</span>, <span class="dt">bs =</span> <span class="st">"cr"</span>)),</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">model =</span> boston_rf</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; Cannot extract model family. Use gaussian.</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; Cannot extract model link. Use identity.</span></a></code></pre></div>
<p>Lets check the model summary:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(xp_model)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; glm(formula = cmedv ~ rm + lstat + xs(nox), family = family, </span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;     data = data)</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; Deviance Residuals: </span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;      Min        1Q    Median        3Q       Max  </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; -13.3754   -3.3141   -0.9339    2.0499   27.1722  </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; (Intercept) -32.40688    4.84433  -6.690 5.98e-11 ***</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; rm            5.26616    0.41581  12.665  &lt; 2e-16 ***</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; lstat        -0.51954    0.04371 -11.886  &lt; 2e-16 ***</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; xs(nox)       1.22869    0.15052   8.163 2.66e-15 ***</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 26.77072)</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"><span class="co">#&gt;     Null deviance: 42578  on 505  degrees of freedom</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="co">#&gt; Residual deviance: 13439  on 502  degrees of freedom</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="co">#&gt; AIC: 3105.3</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></a></code></pre></div>
<p>As you can see in the summary, the final formula is simplified version of input one. All the information about the response functions are stored in <code>xp_model</code> environment.</p>
</div>
<div id="plotting-the-result" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-the-result" class="anchor"></a>Plotting the result</h3>
<p><em>(in progress)</em></p>
<p>You may plot simple graphics for resulting model with <code>xp_plot</code> function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(xp_model, <span class="st">"nox"</span>, <span class="dt">data =</span> boston, <span class="dt">plot_data =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(xp_model, <span class="st">"nox"</span>)</a></code></pre></div>
<p><img src="xspliner_files/figure-html/unnamed-chunk-8-1.png" width="288"><img src="xspliner_files/figure-html/unnamed-chunk-8-2.png" width="288"></p>
</div>
<div id="is-spline-transformation-always-better" class="section level3">
<h3 class="hasAnchor">
<a href="#is-spline-transformation-always-better" class="anchor"></a>Is spline transformation always better?</h3>
<p><em>For qualitative variables only</em></p>
<p>When the response function has linear form, approximating it with splines may make the result worse. <code>xspline</code> function offers automatical check if spline approximation is better than linear one, and use it in final model.</p>
<p>You may find two parameters responsible for that: - <code>alter</code> - The list of ‘numeric’ and ‘factor’. When <code>alter$numeric == 'auto'</code>, automatically choose whther variable should be transformed with splines - <code>compare_stat</code> - function of <code>lm</code> class object. Defines statistic that should be used in decision between spline model and linear one. The function should have attribute <code>higher</code>. When the attribute has <code>"better"</code> value then the model with higher statistic value is chosen.</p>
<p>You can see the feature in above example:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">boston_rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(cmedv <span class="op">~</span><span class="st"> </span>lstat <span class="op">+</span><span class="st"> </span>ptratio <span class="op">+</span><span class="st"> </span>age, <span class="dt">data =</span> boston) </a>
<a class="sourceLine" id="cb12-3" data-line-number="3">model_pdp_auto &lt;-<span class="st"> </span><span class="kw"><a href="../reference/xspline.html">xspline</a></span>(</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  cmedv <span class="op">~</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">    </span><span class="kw">xs</span>(lstat, <span class="dt">transition =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">k =</span> <span class="dv">6</span>), <span class="dt">effect =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">type =</span> <span class="st">"pdp"</span>, <span class="dt">grid.resolution =</span> <span class="dv">60</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">    </span><span class="kw">xs</span>(ptratio, <span class="dt">transition =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">k =</span> <span class="dv">4</span>), <span class="dt">effect =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">type =</span> <span class="st">"pdp"</span>, <span class="dt">grid.resolution =</span> <span class="dv">40</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">    </span>age,</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  <span class="dt">model =</span> boston_rf,</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="dt">xs_opts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">transition =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">alter =</span> <span class="st">"auto"</span>))</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co"># r_squared statistic is used by default</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(model_pdp_auto)</a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; glm(formula = cmedv ~ xs(lstat) + ptratio + age, family = family, </span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt;     data = data)</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt; Deviance Residuals: </span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="co">#&gt;      Min        1Q    Median        3Q       Max  </span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="co">#&gt; -12.7619   -3.2031   -0.6366    2.8787   26.9953  </span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="co">#&gt; (Intercept)  4.638819   2.952287   1.571    0.117    </span></a>
<a class="sourceLine" id="cb12-27" data-line-number="27"><span class="co">#&gt; xs(lstat)    1.248040   0.048545  25.709  &lt; 2e-16 ***</span></a>
<a class="sourceLine" id="cb12-28" data-line-number="28"><span class="co">#&gt; ptratio     -0.858557   0.113027  -7.596 1.51e-13 ***</span></a>
<a class="sourceLine" id="cb12-29" data-line-number="29"><span class="co">#&gt; age          0.054359   0.009827   5.532 5.11e-08 ***</span></a>
<a class="sourceLine" id="cb12-30" data-line-number="30"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb12-31" data-line-number="31"><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></a>
<a class="sourceLine" id="cb12-32" data-line-number="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-33" data-line-number="33"><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 24.87722)</span></a>
<a class="sourceLine" id="cb12-34" data-line-number="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-35" data-line-number="35"><span class="co">#&gt;     Null deviance: 42578  on 505  degrees of freedom</span></a>
<a class="sourceLine" id="cb12-36" data-line-number="36"><span class="co">#&gt; Residual deviance: 12488  on 502  degrees of freedom</span></a>
<a class="sourceLine" id="cb12-37" data-line-number="37"><span class="co">#&gt; AIC: 3068.2</span></a>
<a class="sourceLine" id="cb12-38" data-line-number="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-39" data-line-number="39"><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></a></code></pre></div>
<p>Linear approximation was better for <code>ptratio</code> response function.</p>
</div>
</div>
<div id="further-work" class="section level2">
<h2 class="hasAnchor">
<a href="#further-work" class="anchor"></a>Further work</h2>
<p>See <a href="https://github.com/krystian8207/xspliner/issues">github issues</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#motivation">Motivation</a></li>
      <li><a href="#general-idea">General idea</a></li>
      <li><a href="#how-to-do-it-with-xspliner">How to do it with xspliner?</a></li>
      <li><a href="#further-work">Further work</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Krystian Igras, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
